@using System.ComponentModel.DataAnnotations
@using Microsoft.Fast.Components.FluentUI
@using Microsoft.Fast.Components.FluentUI.DesignTokens
@using Pokewordle.Shared.Extensions
@using Pokewordle.Shared.Services
@using Color = System.Drawing.Color
@using Pokewordle.Shared.Util;
@inject HttpClient httpClient;
@inject NavigationManager NavigationManager;
@inject SettingsService SettingsService;


<link href="/css/pokecss/SearchBox.css" rel="stylesheet"/>
<div id="language-input fluent-combo-box">
    <FluentCombobox @ref="ThemeComboBox" TOption="Theme" Items="@themes" 
                    bind-Value="@selectedTheme"
                    Autocomplete="ComboboxAutocomplete.Both" OptionText="s => s.ToString()"
                    @* Below is not necessarily a bug. It works *@
                    SelectedOptionChanged="ValueChangedHandler"
                    Appearance="Appearance.Filled"
                    Id="theme-input" Style="width:13rem; height: 2rem">
    </FluentCombobox>
</div>


@code {
    private FluentCombobox<Theme> ThemeComboBox;
    
    private Theme selectedTheme = Theme.Forest;
    
    private List<Theme> themes = Enum.GetValues<Theme>().ToList();

    public List<string> themeNames { get; set; }

    // fluentui design tokens
    [Inject]
    private BaseLayerLuminance BaseLayerLuminance { get; set; } = default!;

    [Inject]
    private AccentBaseColor AccentBaseColor { get; set; } = default!;

    [Inject]
    private BodyFont BodyFont { get; set; } = default!;

    [Inject]
    private StrokeWidth StrokeWidth { get; set; } = default!;

    [Inject]
    private ControlCornerRadius ControlCornerRadius { get; set; } = default!;

    [Inject]
    private FillColor FillColor { get; set; } = default!;

    // private Microsoft.Fast.Components.FluentUI.DesignTokens.FillColor fill
    // Microsoft.Fast.Components.FluentUI.DesignTokens.Neutral
    [Inject]
    private StrokeWidth Strokewidth { get; set; } = default!;

    // Microsoft.Fast.Components.FluentUI.DesignTokens.Swatch
    [Inject]
    NeutralFillActive NeutralFillActive { get; set; } = default!;

    [Inject]
    NeutralBaseColor NeutralBaseColor { get; set; } = default!;

    [Inject]
    NeutralFillRest NeutralFillRest { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        themeNames = Enum.GetNames<Theme>().ToList();
        
        Enum.TryParse<Theme>(await SettingsService.GetSettingAsync("theme"), out selectedTheme);
    }

    private async void ValueChangedHandler(Theme value)
    {

        SettingsService.SetSettingAsync("theme", value.ToString());

        SharedThemeSetting.theme = value;
        NavigationManager.NavigateTo("/settings");
    }


    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
    //Set to dark mode
    // await BaseLayerLuminance.SetValueFor(ref1!.Element, (float)0.15);

            await AccentBaseColor.SetValueFor(ThemeComboBox!.Element, "#0c4337".ToSwatch());
            await BaseLayerLuminance.SetValueFor(ThemeComboBox!.Element, (float)0.15);
            await NeutralBaseColor.SetValueFor(ThemeComboBox!.Element, "#2b3539".ToSwatch());

            StateHasChanged();
        }
    }

}